<?xml version="1.0" encoding="utf-8"?>
<robot xmlns:xacro="https://ros.org/wiki/xacro">
  <xacro:macro name="endo" params="prefix connected_to">

    <joint name="${prefix}J7" type="fixed">
      <parent link="${connected_to}"/>
      <child link="${prefix}LINK7"/>
      <origin rpy="0 0 0" xyz="0 0 -0.0135"/>
    </joint>

    <link name="${prefix}LINK7">
      <inertial>
        <origin
          xyz="2.31455226527066E-05 -0.00387688744223635 0.0981367759323445"
          rpy="0 0 0" />
        <mass
          value="0.507250397051115" />
        <inertia
          ixx="0.00166103614182656"
          ixy="-6.61684042563449E-07"
          ixz="-4.40382594514631E-07"
          iyy="0.00064142259778365"
          iyz="2.62042834067411E-05"
          izz="0.00189492280952751" />
      </inertial>
      <visual>
        <geometry>
          <mesh filename="package://endo_description/meshes/visual/LINK7.dae"/>
        </geometry>
        <origin
          xyz="0 0 0"
          rpy="0 0 0" />
        <material
          name="">
          <color
            rgba="0.752941176470588 0.752941176470588 0.752941176470588 1" />
        </material>
      </visual>
      <collision>
        <origin
          xyz="0 0 0"
          rpy="0 0 0" />
        <geometry>
          <mesh filename="package://endo_description/meshes/collision/LINK7.STL"/>
        </geometry>
      </collision>
    </link>

    <joint name="${prefix}J8" type="revolute">
      <parent link="${prefix}LINK7"/>
      <child link="${prefix}SCOPE"/>
      <origin rpy="1.5708 0 0" xyz="0 -0.13722 0.091235"/>
      <axis xyz="0 0 -1" />
      <limit effort="150.0" lower="-6" upper="6" velocity="3.15" />
    </joint>

    <link name="${prefix}SCOPE">
      <inertial>
        <origin
          xyz="0.000499304671632852 0.00223530441796144 -0.0847443350054828"
          rpy="0 0 0" />
        <mass
          value="0.444647660330151" />
        <inertia
          ixx="0.00189128705782164"
          ixy="-2.67338006490719E-07"
          ixz="-2.12769869497079E-07"
          iyy="0.00188997865857834"
          iyz="-1.22500667076317E-06"
          izz="0.000392923038098468" />
      </inertial>
      <visual>
        <origin
          xyz="0 0 0"
          rpy="0 0 0" />
        <geometry>
          <mesh filename="package://endo_description/meshes/visual/SCOPE.dae"/>
        </geometry>
        <material
          name="">
          <color
            rgba="0.792156862745098 0.819607843137255 0.933333333333333 1" />
        </material>
      </visual>
      <collision>
        <origin
          xyz="0 0 0"
          rpy="0 0 0" />
        <geometry>
          <mesh filename="package://endo_description/meshes/collision/SCOPE.STL"/>
        </geometry>
      </collision>
    </link>

    <joint name="${prefix}J9" type="fixed">
      <!-- The parent link must be read from the robot model it is attached to. -->
      <parent link="${prefix}SCOPE"/>
      <child link="${prefix}camera"/>
      <origin rpy="3.14159 -1.0472 1.5708" xyz="0 0 0.37"/>
      <axis
        xyz="0 0 0" />
    </joint>

    <link name="${prefix}camera"></link>

    <transmission name="J8_trans">
        <type>transmission_interface/SimpleTransmission</type>
        <joint name="${prefix}J8">
    <hardwareInterface>hardware_interface/PositionJointInterface</hardwareInterface>
        </joint>
        <actuator name="J8_motor">
    <mechanicalReduction>1</mechanicalReduction>
        </actuator>
    </transmission>

    <gazebo reference="${prefix}LINK7">
	      <selfCollide>true</selfCollide>
	  </gazebo>
	  <gazebo reference="${prefix}SCOPE">
	      <selfCollide>true</selfCollide>
	  </gazebo>
	  <gazebo reference="${prefix}SPHERE">
      	      <selfCollide>true</selfCollide>
      	  </gazebo>

	  <gazebo reference="${prefix}camera">
	    <selfCollide>true</selfCollide>
          <material>Gazebo/Green</material>
          <sensor type="camera" name="camera1">
            <update_rate>30.0</update_rate>
            <visualize>true</visualize>
            <camera name="head">
              <horizontal_fov>1.3962634</horizontal_fov>
              <image>
                <width>800</width>
                <height>800</height>
                <format>R8G8B8</format>
              </image>
              <clip>
                <near>0.02</near>
                <far>300</far>
              </clip>
            </camera>
            <plugin name="camera_controller" filename="libgazebo_ros_camera.so">
              <alwaysOn>true</alwaysOn>
              <cameraName>/tip_camera</cameraName>
            </plugin>
          </sensor>
        </gazebo>
	  <gazebo>
	    <plugin name="ros_control" filename="libgazebo_ros_control.so">
	    </plugin>
	  </gazebo>

  </xacro:macro>
</robot>
